<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperMarket System</title>
    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --primary-color: #2E7D32;      /* Verde escuro */
            --secondary-color: #FF9800;    /* Laranja */
            --success-color: #43A047;      /* Verde sucesso */
            --danger-color: #D32F2F;       /* Vermelho erro */
            --light-color: #F5F5F5;        /* Cinza claro */
            --border-radius: 8px;          /* Bordas arredondadas */
        }

        /* Estilos Gerais */
        body {
            background-color: var(--light-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Navbar */
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background-color: var(--primary-color) !important;
            padding: 1rem;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: white !important;
        }

        .navbar-dark .navbar-nav .nav-link {
            color: rgba(255,255,255,0.9) !important;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
        }

        .navbar-dark .navbar-nav .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            transform: translateY(-1px);
        }

        /* Container Principal */
        .container {
            padding: 2rem 1rem;
        }

        /* Cards e Seções */
        .section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }

        /* Formulários */
        .form-control {
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 152, 0, 0.25);
        }

        .form-group label {
            color: #555;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        /* Botões */
        .btn {
            border-radius: var(--border-radius);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #1B5E20;
            border-color: #1B5E20;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #F57C00;
            border-color: #F57C00;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        /* Tabelas */
        .table {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border-bottom: none;
            padding: 1rem;
            font-weight: 500;
        }

        .table tbody tr:nth-child(even) {
            background-color: rgba(0,0,0,0.02);
        }

        .table tbody td {
            padding: 1rem;
            vertical-align: middle;
            border-top: 1px solid #eee;
        }

        /* Toast (Mensagens) */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: none;
        }

        .toast-header {
            background-color: white;
            border-bottom: none;
            padding: 1rem;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .toast-body {
            padding: 1rem;
            font-weight: 500;
        }

        .toast-success {
            background-color: var(--success-color);
            color: white;
        }

        .toast-error {
            background-color: var(--danger-color);
            color: white;
        }

        /* Responsividade para dispositivos móveis */
        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1.2rem;
            }

            .section {
                padding: 1rem;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .table-responsive {
                border-radius: var(--border-radius);
            }
        }

        /* Animações e Transições */
        .form-control, .btn, .nav-link {
            transition: all 0.3s ease-in-out;
        }

        /* Customização do Select */
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 8px 10px;
            padding-right: 2rem;
        }

        /* Estilo para inputs numéricos */
        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Estilo para checkbox personalizado */
        .form-check-input {
            width: 1.2rem;
            height: 1.2rem;
            margin-top: 0.2rem;
        }

        .form-check-label {
            padding-left: 0.5rem;
            color: #555;
        }

        /* Badges e Status */
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
        }

        .badge-success {
            background-color: var(--success-color);
        }

        .badge-danger {
            background-color: var(--danger-color);
        }

        /* Ícones */
        .fa, .fas {
            margin-right: 0.5rem;
        }

        /* Cards de Resumo */
        .summary-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-card h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">Sistema de Vendas</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('clientes')">Clientes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('categorias')">Categorias</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('produtos')">Produtos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('vendas')">Vendas</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Seção Clientes -->
        <div id="clientes" class="section">
            <h2>Cadastro de Clientes</h2>
            <form id="clienteForm" class="mb-4">
                <div class="form-group">
                    <label for="clienteNome">Nome</label>
                    <input type="text" class="form-control" id="clienteNome" required>
                </div>
                <div class="form-group">
                    <label for="clienteCPF">CPF</label>
                    <input type="text" class="form-control" id="clienteCPF" required>
                </div>
                <div class="form-group">
                    <label for="clienteTelefone">Telefone</label>
                    <input type="text" class="form-control" id="clienteTelefone" required>
                </div>
                <button type="submit" class="btn btn-primary">Cadastrar Cliente</button>
            </form>
            <h3>Clientes Cadastrados</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>CPF</th>
                            <th>Telefone</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="clientesTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Seção Categorias -->
        <div id="categorias" class="section" style="display: none;">
            <h2>Cadastro de Categorias</h2>
            <form id="categoriaForm" class="mb-4">
                <div class="form-group">
                    <label for="categoriaDescricao">Descrição</label>
                    <input type="text" class="form-control" id="categoriaDescricao" required>
                </div>
                <button type="submit" class="btn btn-primary">Cadastrar Categoria</button>
            </form>
            <h3>Categorias Cadastradas</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Descrição</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="categoriasTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Seção Produtos -->
        <div id="produtos" class="section" style="display: none;">
            <h2>Cadastro de Produtos</h2>
            <form id="produtoForm" class="mb-4">
                <div class="form-group">
                    <label for="produtoNome">Nome do Produto</label>
                    <input type="text" class="form-control" id="produtoNome" required>
                </div>
                <div class="form-group">
                    <label for="produtoCategoria">Categoria</label>
                    <select class="form-control" id="produtoCategoria" required></select>
                </div>
                <div class="form-group">
                    <label for="produtoPreco">Preço Unitário</label>
                    <input type="number" step="0.01" class="form-control" id="produtoPreco" required>
                </div>
                <div class="form-group">
                    <label for="produtoEstoque">Estoque Disponível</label>
                    <input type="number" class="form-control" id="produtoEstoque" required>
                </div>
                <button type="submit" class="btn btn-primary">Cadastrar Produto</button>
            </form>
            <h3>Produtos Cadastrados</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Categoria</th>
                            <th>Preço</th>
                            <th>Estoque</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="produtosTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Seção Vendas -->
        <div id="vendas" class="section" style="display: none;">
            <h2>Registro de Vendas</h2>
            <form id="vendaForm" class="mb-4">
                <div class="form-group">
                    <label for="vendaCliente">Cliente</label>
                    <select class="form-control" id="vendaCliente" required></select>
                </div>
                <div id="produtosVenda">
                    <h4>Produtos</h4>
                    <button type="button" class="btn btn-secondary mb-3" onclick="adicionarProdutoVenda()">
                        Adicionar Produto
                    </button>
                    <div id="itensProdutos"></div>
                </div>
                <div class="form-group">
                    <label>Valor Total: R$ <span id="valorTotal">0.00</span></label>
                </div>
                <button type="submit" class="btn btn-primary">Registrar Venda</button>
            </form>
            <h3>Vendas Registradas</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Produtos</th>
                            <th>Valor Total</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="vendasTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Toast para mensagens -->
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="3000">
        <div class="toast-header">
            <strong class="mr-auto" id="toastTitle">Mensagem</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast">&times;</button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Banco de dados
        let db = {
            clientes: [],
            categorias: [],
            produtos: [],
            vendas: []
        };

        // Funções auxiliares
        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]/g, '');
            if (cpf.length !== 11) return false;

            if (/^(\d)\1{10}$/.test(cpf)) return false;

            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let resto = 11 - (soma % 11);
            let digitoVerificador1 = resto > 9 ? 0 : resto;
            if (digitoVerificador1 !== parseInt(cpf.charAt(9))) return false;

            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            resto = 11 - (soma % 11);
            let digitoVerificador2 = resto > 9 ? 0 : resto;
            return digitoVerificador2 === parseInt(cpf.charAt(10));
        }

        function formatarCPF(cpf) {
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }

        function formatarTelefone(telefone) {
            return telefone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function showToast(message, isSuccess = true) {
            const toast = $('.toast');
            const icon = isSuccess ? 'check-circle' : 'exclamation-circle';
            $('#toastTitle').html(`
                <i class="fas fa-${icon}"></i> 
                ${isSuccess ? 'Sucesso' : 'Erro'}
            `);
            $('#toastMessage').text(message);
            toast.toast('show');
        }

        function showSection(sectionId) {
            $('.section').hide();
            $(`#${sectionId}`).show();
        }

        // Gerenciamento de Clientes
        document.getElementById('clienteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const nome = document.getElementById('clienteNome').value;
            const cpf = document.getElementById('clienteCPF').value.replace(/[^\d]/g, '');
            const telefone = document.getElementById('clienteTelefone').value.replace(/[^\d]/g, '');

            if (!validarCPF(cpf)) {
                showToast('CPF inválido!', false);
                return;
            }

            const cliente = {
                id: db.clientes.length + 1,
                nome,
                cpf,
                telefone
            };

            db.clientes.push(cliente);
            this.reset();
            atualizarTabelaClientes();
            atualizarSelectClientes();
            showToast('Cliente cadastrado com sucesso!');
        });

        function atualizarTabelaClientes() {
            const tbody = document.getElementById('clientesTable');
            tbody.innerHTML = '';
            db.clientes.forEach(cliente => {
                tbody.innerHTML += `
                    <tr>
                        <td>${cliente.id}</td>
                        <td>${cliente.nome}</td>
                        <td>${formatarCPF(cliente.cpf)}</td>
                        <td>${formatarTelefone(cliente.telefone)}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removerCliente(${cliente.id})">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function atualizarSelectClientes() {
            const select = document.getElementById('vendaCliente');
            select.innerHTML = '<option value="">Selecione um cliente</option>';
            db.clientes.forEach(cliente => {
                select.innerHTML += `<option value="${cliente.id}">${cliente.nome}</option>`;
            });
        }

        // Gerenciamento de Categorias
        document.getElementById('categoriaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const descricao = document.getElementById('categoriaDescricao').value;

            const categoria = {
                id: db.categorias.length + 1,
                descricao
            };

            db.categorias.push(categoria);
            this.reset();
            atualizarTabelaCategorias();
            atualizarSelectCategorias();
            showToast('Categoria cadastrada com sucesso!');
        });

        function atualizarTabelaCategorias() {
            const tbody = document.getElementById('categoriasTable');
            tbody.innerHTML = '';
            db.categorias.forEach(categoria => {
                tbody.innerHTML += `
                    <tr>
                        <td>${categoria.id}</td>
                        <td>${categoria.descricao}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removerCategoria(${categoria.id})">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function atualizarSelectCategorias() {
            const select = document.getElementById('produtoCategoria');
            select.innerHTML = '<option value="">Selecione uma categoria</option>';
            db.categorias.forEach(categoria => {
                select.innerHTML += `<option value="${categoria.id}">${categoria.descricao}</option>`;
            });
        }

        // Gerenciamento de Produtos
        document.getElementById('produtoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const nome = document.getElementById('produtoNome').value;
            const categoriaId = parseInt(document.getElementById('produtoCategoria').value);
            const preco = parseFloat(document.getElementById('produtoPreco').value);
            const estoque = parseInt(document.getElementById('produtoEstoque').value);

            const produto = {
                id: db.produtos.length + 1,
                nome,
                categoriaId,
                preco,
                estoque
            };

            db.produtos.push(produto);
            this.reset();
            atualizarTabelaProdutos();
            showToast('Produto cadastrado com sucesso!');
        });

        function atualizarTabelaProdutos() {
            const tbody = document.getElementById('produtosTable');
            tbody.innerHTML = '';
            db.produtos.forEach(produto => {
                const categoria = db.categorias.find(c => c.id === produto.categoriaId);
                tbody.innerHTML += `
                    <tr>
                        <td>${produto.id}</td>
                        <td>${produto.nome}</td>
                        <td>${categoria ? categoria.descricao : 'N/A'}</td>
                        <td>${formatarMoeda(produto.preco)}</td>
                        <td>${produto.estoque}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removerProduto(${produto.id})">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // Gerenciamento de Vendas
        function adicionarProdutoVenda() {
            const container = document.getElementById('itensProdutos');
            const itemId = container.children.length + 1;
            
            const produtosDisponiveis = db.produtos.filter(p => p.estoque > 0);
            if (produtosDisponiveis.length === 0) {
                showToast('Não há produtos disponíveis em estoque!', false);
                return;
            }

            const itemHtml = `
                <div class="form-row mb-3" id="item${itemId}">
                    <div class="col-md-5">
                        <select class="form-control produto-select" onchange="atualizarQuantidadeMaxima(this)" required>
                            <option value="">Selecione um produto</option>
                            ${produtosDisponiveis.map(p => `
                                <option value="${p.id}" data-estoque="${p.estoque}" data-preco="${p.preco}">
                                    ${p.nome} (Estoque: ${p.estoque})
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="number" class="form-control quantidade-input" 
                               placeholder="Quantidade" min="1" required
                               onchange="calcularTotalVenda()">
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger" 
                                onclick="removerProdutoVenda(${itemId})">Remover</button>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', itemHtml);
        }

        function removerProdutoVenda(itemId) {
            document.getElementById(`item${itemId}`).remove();
            calcularTotalVenda();
        }

        function atualizarQuantidadeMaxima(select) {
            const quantidadeInput = select.parentElement.nextElementSibling.querySelector('input');
            const option = select.options[select.selectedIndex];
            const estoque = parseInt(option.dataset.estoque);
            quantidadeInput.max = estoque;
            quantidadeInput.value = '';
            calcularTotalVenda();
        }

        function calcularTotalVenda() {
            let total = 0;
            document.querySelectorAll('.form-row').forEach(row => {
                const select = row.querySelector('.produto-select');
                const quantidade = row.querySelector('.quantidade-input');
                
                if (select.value && quantidade.value) {
                    const preco = parseFloat(select.options[select.selectedIndex].dataset.preco);
                    total += preco * parseInt(quantidade.value);
                }
            });

            document.getElementById('valorTotal').textContent = formatarMoeda(total).replace('R$', '').trim();
        }

        document.getElementById('vendaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const clienteId = parseInt(document.getElementById('vendaCliente').value);
            const itens = [];
            let isValid = true;

            document.querySelectorAll('.form-row').forEach(row => {
                const select = row.querySelector('.produto-select');
                const quantidade = row.querySelector('.quantidade-input');
                
                if (select.value && quantidade.value) {
                    const produtoId = parseInt(select.value);
                    const qtd = parseInt(quantidade.value);
                    const produto = db.produtos.find(p => p.id === produtoId);

                    if (qtd > produto.estoque) {
                        showToast(`Quantidade indisponível para o produto ${produto.nome}!`, false);
                        isValid = false;
                        return;
                    }

                    itens.push({
                        produtoId,
                        quantidade: qtd,
                        precoUnitario: produto.preco
                    });
                }
            });

            if (!isValid) return;
            if (itens.length === 0) {
                showToast('Adicione pelo menos um produto!', false);
                return;
            }

            const total = itens.reduce((sum, item) => sum + (item.precoUnitario * item.quantidade), 0);

            const venda = {
                id: db.vendas.length + 1,
                clienteId,
                itens,
                total,
                data: new Date()
            };

            // Atualizar estoque
            venda.itens.forEach(item => {
                const produto = db.produtos.find(p => p.id === item.produtoId);
                produto.estoque -= item.quantidade;
            });

            db.vendas.push(venda);
            this.reset();
            document.getElementById('itensProdutos').innerHTML = '';
            document.getElementById('valorTotal').textContent = '0.00';
            atualizarTabelaVendas();
            atualizarTabelaProdutos();
            showToast('Venda registrada com sucesso!');
        });

        function atualizarTabelaVendas() {
            const tbody = document.getElementById('vendasTable');
            tbody.innerHTML = '';
            db.vendas.forEach(venda => {
                const cliente = db.clientes.find(c => c.id === venda.clienteId);
                const produtos = venda.itens.map(item => {
                    const produto = db.produtos.find(p => p.id === item.produtoId);
                    return `${produto ? produto.nome : 'N/A'} (${item.quantidade}x)`;
                }).join(', ');

                tbody.innerHTML += `
                    <tr>
                        <td>${venda.id}</td>
                        <td>${cliente ? cliente.nome : 'N/A'}</td>
                        <td>${produtos}</td>
                        <td>${formatarMoeda(venda.total)}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removerVenda(${venda.id})">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // Funções de remoção
        function removerCliente(id) {
            if (confirm('Tem certeza que deseja remover este cliente?')) {
                // Verifica se o cliente tem vendas associadas
                const temVendas = db.vendas.some(v => v.clienteId === id);
                if (temVendas) {
                    showToast('Não é possível remover este cliente pois existem vendas associadas!', false);
                    return;
                }

                db.clientes = db.clientes.filter(c => c.id !== id);
                atualizarTabelaClientes();
                atualizarSelectClientes();
                showToast('Cliente removido com sucesso!');
            }
        }

        function removerCategoria(id) {
            if (confirm('Tem certeza que deseja remover esta categoria?')) {
                // Verifica se existem produtos associados
                const temProdutos = db.produtos.some(p => p.categoriaId === id);
                if (temProdutos) {
                    showToast('Não é possível remover esta categoria pois existem produtos associados!', false);
                    return;
                }

                db.categorias = db.categorias.filter(c => c.id !== id);
                atualizarTabelaCategorias();
                atualizarSelectCategorias();
                showToast('Categoria removida com sucesso!');
            }
        }

        function removerProduto(id) {
            if (confirm('Tem certeza que deseja remover este produto?')) {
                // Verifica se o produto tem vendas associadas
                const temVendas = db.vendas.some(v => v.itens.some(i => i.produtoId === id));
                if (temVendas) {
                    showToast('Não é possível remover este produto pois existem vendas associadas!', false);
                    return;
                }

                db.produtos = db.produtos.filter(p => p.id !== id);
                atualizarTabelaProdutos();
                showToast('Produto removido com sucesso!');
            }
        }

        // Adicionar função de remoção de venda
        function removerVenda(id) {
            if (confirm('Tem certeza que deseja remover esta venda?')) {
                // Encontrar a venda
                const venda = db.vendas.find(v => v.id === id);
                if (!venda) {
                    showToast('Venda não encontrada!', false);
                    return;
                }

                // Restaurar o estoque dos produtos
                venda.itens.forEach(item => {
                    const produto = db.produtos.find(p => p.id === item.produtoId);
                    if (produto) {
                        produto.estoque += item.quantidade;
                    }
                });

                // Remover a venda
                db.vendas = db.vendas.filter(v => v.id !== id);

                // Atualizar as tabelas
                atualizarTabelaVendas();
                atualizarTabelaProdutos();
                showToast('Venda removida com sucesso! O estoque foi atualizado.');
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            showSection('clientes');
            
            // Máscara para CPF
            document.getElementById('clienteCPF').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                    e.target.value = value;
                }
            });

            // Máscara para telefone
            document.getElementById('clienteTelefone').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                    e.target.value = value;
                }
            });
        });
    </script>
</body>
</html> 